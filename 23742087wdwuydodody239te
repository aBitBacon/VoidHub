if _G.MainScriptLoaded then
    warn("üö´ Main script already loaded. Preventing duplicate execution.")
    return
end
_G.MainScriptLoaded = true
local Players = game:GetService("Players")
local whitelist = { 3325022006, 5742786773 }

local player = Players.LocalPlayer
local playerId = player.UserId

print("üë§ Player ID detected:", playerId)

local isWhitelisted = false
for _, id in ipairs(whitelist) do
    if id == playerId then
        isWhitelisted = true
        break
    end
end

if not isWhitelisted then
    warn("‚ùå Access denied for ID:", playerId)
    player:Kick("VOID HUB, YOU DONT GOT ACCESS")
    return
end

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local Window = Fluent:CreateWindow({
    Title = "Main Page" .. Fluent.Version,
    SubTitle = "Muscle Legends OP REB!",
    Size = UDim2.fromOffset(450, 300),
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local function FastRebirth(enabled)
    if enabled then
        task.spawn(function()
            while enabled do
                -- Fast Rebirth Logic
                local a = game:GetService("ReplicatedStorage")
                local b = game:GetService("Players")
                local c = b.LocalPlayer
                local d = function(e)
                    local f = c.petsFolder
                    for g, h in pairs(f:GetChildren()) do
                        if h:IsA("Folder") then
                            for i, j in pairs(h:GetChildren()) do
                                a.rEvents.equipPetEvent:FireServer("unequipPet", j)
                            end
                        end
                    end
                    task.wait(0.1)
                end
                local k = function(l)
                    d()
                    task.wait(0.01)
                    for m, n in pairs(c.petsFolder.Unique:GetChildren()) do
                        if n.Name == l then
                            a.rEvents.equipPetEvent:FireServer("equipPet", n)
                        end
                    end
                end
                local o = function(p)
                    local q = workspace.machinesFolder:FindFirstChild(p)
                    if not q then
                        for r, s in pairs(workspace:GetChildren()) do
                            if s:IsA("Folder") and s.Name:find("machines") then
                                q = s:FindFirstChild(p)
                                if q then
                                    break
                                end
                            end
                        end
                    end
                    return q
                end
                local t = function()
                    local u = game:GetService("VirtualInputManager")
                    u:SendKeyEvent(true, "E", false, game)
                    task.wait(0.1)
                    u:SendKeyEvent(false, "E", false, game)
                end
                task.spawn(function()
                    while enabled do
                        local v = c.leaderstats.Rebirths.Value
                        local w = 10000 + (5000 * v)
                        if c.ultimatesFolder:FindFirstChild("Golden Rebirth") then
                            local x = c.ultimatesFolder["Golden Rebirth"].Value
                            w = math.floor(w * (1 - (x * 0.1)))
                        end
                        d()
                        task.wait(0.1)
                        k("Neon Guardian")
                        while c.leaderstats.Strength.Value < w do
                            for y = 1, 10 do
                                c.muscleEvent:FireServer("rep")
                            end
                            task.wait()
                        end
                        d()
                        task.wait(0.1)
                        k("Tribal Overlord")
                        local z = o("Jungle Bar Lift")
                        if z and z:FindFirstChild("interactSeat") then
                            c.Character.HumanoidRootPart.CFrame = z.interactSeat.CFrame * CFrame.new(0, 3, 0)
                            repeat
                                task.wait(0.1)
                                t()
                            until c.Character.Humanoid.Sit
                        end
                        local A = c.leaderstats.Rebirths.Value
                        repeat
                            a.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
                            task.wait(0.1)
                        until c.leaderstats.Rebirths.Value > A
                        task.wait()
                    end
                end)
            end
        end)
    end
end

local function HideFrames(enabled)
    if enabled then
        for _, v in pairs(game:GetDescendants()) do
            if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke") or v:IsA("Fire") or v:IsA("Sparkles") then
                v.Enabled = false
            end
        end
        local lighting = game:GetService("Lighting")
        lighting.GlobalShadows = false
        lighting.FogEnd = 9e9
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("BasePart") and not v.Parent:FindFirstChild("Humanoid") then
                v.Material = Enum.Material.SmoothPlastic
                if v:IsA("Texture") then
                    v:Destroy()
                end
            end
        end
        settings().Rendering.QualityLevel = 1
    else
        -- Restore settings or revert changes if necessary
    end
end

local function SpeedGrind(enabled)
    if enabled then
        task.spawn(function()
            local a = game:GetService("ReplicatedStorage")
            local b = game:GetService("Players")
            local c = b.LocalPlayer
            local k = function()
                for m, n in pairs(c.petsFolder.Unique:GetChildren()) do
                    if n.Name == "Swift Samurai" then
                        a.rEvents.equipPetEvent:FireServer("equipPet", n)
                    end
                end
            end
            task.spawn(function()
                k()
                while enabled do
                    for y = 1, 10 do
                        c.muscleEvent:FireServer("rep")
                    end
                    task.wait(0.001)
                end
            end)
        end)
    end
end

local function FastestRebirth(enabled)
    if enabled then
        task.spawn(function()
            local a = game:GetService("ReplicatedStorage")
            local b = game:GetService("Players")
            local c = b.LocalPlayer
            local d = function(e)
                local f = c.petsFolder
                for g, h in pairs(f:GetChildren()) do
                    if h:IsA("Folder") then
                        for i, j in pairs(h:GetChildren()) do
                            a.rEvents.equipPetEvent:FireServer("unequipPet", j)
                        end
                    end
                end
                task.wait(0.1)
            end
            local k = function(l)
                d()
                task.wait(0.01)
                for m, n in pairs(c.petsFolder.Unique:GetChildren()) do
                    if n.Name == l then
                        a.rEvents.equipPetEvent:FireServer("equipPet", n)
                    end
                end
            end
            local o = function(p)
                local q = workspace.machinesFolder:FindFirstChild(p)
                if not q then
                    for r, s in pairs(workspace:GetChildren()) do
                        if s:IsA("Folder") and s.Name:find("machines") then
                            q = s:FindFirstChild(p)
                            if q then
                                break
                            end
                        end
                    end
                end
                return q
            end
            local t = function()
                local u = game:GetService("VirtualInputManager")
                u:SendKeyEvent(true, "E", false, game)
                task.wait(0.1)
                u:SendKeyEvent(false, "E", false, game)
            end
            task.spawn(function()
                while enabled do
                    local v = c.leaderstats.Rebirths.Value
                    local w = 10000 + (5000 * v)
                    if c.ultimatesFolder:FindFirstChild("Golden Rebirth") then
                        local x = c.ultimatesFolder["Golden Rebirth"].Value
                        w = math.floor(w * (1 - (x * 0.1)))
                    end
                    d()
                    task.wait(0.1)
                    k("Swift Samurai")
                    while c.leaderstats.Strength.Value < w do
                        for y = 1, 10 do
                            c.muscleEvent:FireServer("rep")
                        end
                        task.wait()
                    end
                    d()
                    task.wait(0.1)
                    k("Tribal Overlord")
                    local z = o("Jungle Bar Lift")
                    if z and z:FindFirstChild("interactSeat") then
                        c.Character.HumanoidRootPart.CFrame = z.interactSeat.CFrame * CFrame.new(0, 3, 0)
                        repeat
                            task.wait(0.1)
                            t()
                        until c.Character.Humanoid.Sit
                    end
                    local A = c.leaderstats.Rebirths.Value
                    repeat
                        a.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
                        task.wait(0.1)
                    until c.leaderstats.Rebirths.Value > A
                    task.wait()
                end
            end)
        end)
    end
end

local function AutoProteinEgg(enabled)
    if enabled then
        task.spawn(function()
            local LocalPlayer = game:GetService("Players").LocalPlayer
            local muscleEvent = LocalPlayer:WaitForChild("muscleEvent")
            while enabled do
                wait(1800)
                muscleEvent:FireServer("proteinEgg", LocalPlayer.Backpack:FindFirstChild("Protein Egg"))
            end
        end)
    end
end

Tabs.Main:AddToggle("FastRebirthToggle", { Title = "Fast Rebirth", Default = false, Callback = FastRebirth })
Tabs.Settings:AddToggle("HideFramesToggle", { Title = "Hide All Frames", Default = false, Callback = HideFrames })
Tabs.Main:AddToggle("SpeedGrindToggle", { Title = "Speed Grind", Default = false, Callback = SpeedGrind })
Tabs.Main:AddToggle("FastestRebirthToggle", { Title = "8 PACKS FAST REB", Default = false, Callback = FastestRebirth })
Tabs.Main:AddToggle("AutoProteinEggToggle", { Title = "Protein Egg", Default = false, Callback = AutoProteinEgg })

Window:SelectTab(1)
Fluent:Notify({
    Title = "OP SCRIPT KYY",
    Content = "The script has been loaded.",
    Duration = 5
})
